<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¡œê·¸ì¸ - eApproveSystem</title>
<style>
@import
	url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap')
	;

:root {
	--primary-color: #4a90e2;
	--primary-hover-color: #357abd;
	--background-color: #f7f9fc;
	--form-background-color: #ffffff;
	--text-color: #333333;
	--subtle-text-color: #767676;
	--border-color: #e0e0e0;
	--error-color: #d93025;
	--success-color: #34a853;
	--certificate-color: #ea4335;
	--certificate-hover-color: #d33b2c;
}

body {
	font-family: 'Noto Sans KR', sans-serif;
	display: flex;
	justify-content: center;
	align-items: center;
	min-height: 100vh;
	background-color: var(--background-color);
	margin: 0;
	padding: 20px;
	box-sizing: border-box;
}

.login-wrapper {
	width: 100%;
	max-width: 420px;
	padding: 40px;
	background-color: var(--form-background-color);
	border-radius: 12px;
	box-shadow: 0 8px 24px rgba(149, 157, 165, 0.2);
	text-align: center;
}

.logo {
	margin-bottom: 30px;
}

.logo h1 {
	font-size: 28px;
	color: var(--primary-color);
	margin: 0;
	font-weight: 700;
}

.logo p {
	color: var(--subtle-text-color);
	font-size: 14px;
	margin: 8px 0 0 0;
}

/* ë¡œê·¸ì¸ ë°©ì‹ ì„ íƒ íƒ­ */
.login-tabs {
	display: flex;
	margin-bottom: 25px;
	border-radius: 8px;
	overflow: hidden;
	border: 1px solid var(--border-color);
}

.tab-button {
	flex: 1;
	padding: 12px 16px;
	border: none;
	background-color: #f8f9fa;
	color: var(--subtle-text-color);
	cursor: pointer;
	font-size: 14px;
	font-weight: 500;
	transition: all 0.3s;
	border-right: 1px solid var(--border-color);
}

.tab-button:last-child {
	border-right: none;
}

.tab-button.active {
	background-color: var(--primary-color);
	color: white;
}

.tab-button:hover:not(.active) {
	background-color: #e9ecef;
}

/* ë¡œê·¸ì¸ í¼ ì»¨í…Œì´ë„ˆ */
.login-content {
	position: relative;
	min-height: 280px;
}

.login-form {
	display: none;
}

.login-form.active {
	display: block;
}

/* ì¼ë°˜ ë¡œê·¸ì¸ í¼ */
.normal-login .input-group {
	margin-bottom: 20px;
	text-align: left;
}

.normal-login .input-group input {
	width: 100%;
	padding: 14px;
	border: 1px solid var(--border-color);
	border-radius: 8px;
	box-sizing: border-box;
	font-size: 16px;
	transition: border-color 0.3s, box-shadow 0.3s;
}

.normal-login .input-group input:focus {
	outline: none;
	border-color: var(--primary-color);
	box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
}

.form-options {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 25px;
	font-size: 14px;
}

.form-options .remember-me {
	display: flex;
	align-items: center;
	color: var(--subtle-text-color);
}

.form-options .remember-me input {
	margin-right: 8px;
}

.form-options a {
	color: var(--primary-color);
	text-decoration: none;
}

.form-options a:hover {
	text-decoration: underline;
}

.submit-btn {
	width: 100%;
	padding: 15px;
	border: none;
	border-radius: 8px;
	background-color: var(--primary-color);
	color: white;
	font-size: 18px;
	font-weight: 500;
	cursor: pointer;
	transition: background-color 0.3s;
	margin-bottom: 15px;
}

.submit-btn:hover {
	background-color: var(--primary-hover-color);
}

.submit-btn:disabled {
	background-color: #ccc;
	cursor: not-allowed;
}

/* ê³µì¸ì¸ì¦ì„œ ë¡œê·¸ì¸ */
.certificate-login {
	text-align: center;
}

.certificate-info {
	background-color: #f8f9fa;
	border: 1px solid var(--border-color);
	border-radius: 8px;
	padding: 20px;
	margin-bottom: 20px;
}

.certificate-info h3 {
	margin: 0 0 10px 0;
	color: var(--text-color);
	font-size: 16px;
}

.certificate-info p {
	margin: 0;
	color: var(--subtle-text-color);
	font-size: 14px;
	line-height: 1.5;
}

.certificate-btn {
	width: 100%;
	padding: 15px;
	border: none;
	border-radius: 8px;
	background-color: var(--certificate-color);
	color: white;
	font-size: 18px;
	font-weight: 500;
	cursor: pointer;
	transition: background-color 0.3s;
	margin-bottom: 15px;
	display: flex;
	align-items: center;
	justify-content: center;
}

.certificate-btn:hover {
	background-color: var(--certificate-hover-color);
}

.certificate-btn::before {
	content: "ğŸ“";
	margin-right: 8px;
	font-size: 16px;
}

.certificate-login-btn {
	width: 100%;
	padding: 15px;
	border: none;
	border-radius: 8px;
	background-color: var(--success-color);
	color: white;
	font-size: 18px;
	font-weight: 500;
	cursor: pointer;
	transition: background-color 0.3s;
	margin-bottom: 15px;
	display: flex;
	align-items: center;
	justify-content: center;
}

.certificate-login-btn:hover {
	background-color: #2d8a47;
}

.certificate-login-btn::before {
	content: "ğŸ”";
	margin-right: 8px;
	font-size: 16px;
}

.certificate-login-btn:disabled {
	background-color: #ccc;
	cursor: not-allowed;
}

/* ì„ íƒëœ íŒŒì¼ ì •ë³´ í‘œì‹œ */
.selected-file-info {
	display: flex;
	align-items: center;
	padding: 12px;
	border: 1px solid var(--border-color);
	border-radius: 8px;
	background-color: #f8f9fa;
	margin-bottom: 15px;
}

.file-icon {
	font-size: 24px;
	margin-right: 12px;
}

.file-details {
	flex: 1;
	text-align: left;
}

.file-name {
	font-weight: 500;
	color: var(--text-color);
	font-size: 14px;
	margin-bottom: 2px;
}

.file-size {
	font-size: 12px;
	color: var(--subtle-text-color);
}

.file-remove-btn {
	width: 24px;
	height: 24px;
	border: none;
	border-radius: 50%;
	background-color: #dc3545;
	color: white;
	cursor: pointer;
	font-size: 16px;
	line-height: 1;
	display: flex;
	align-items: center;
	justify-content: center;
}

.file-remove-btn:hover {
	background-color: #c82333;
}

/* ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ ì„¹ì…˜ */
.certificate-password-section {
	margin-bottom: 20px;
}

.certificate-password-section .input-group {
	margin-bottom: 0;
}

.certificate-password-section input {
	width: 100%;
	padding: 14px;
	border: 1px solid var(--border-color);
	border-radius: 8px;
	box-sizing: border-box;
	font-size: 16px;
	transition: border-color 0.3s, box-shadow 0.3s;
}

.certificate-password-section input:focus {
	outline: none;
	border-color: var(--certificate-color);
	box-shadow: 0 0 0 3px rgba(234, 67, 53, 0.2);
}

.certificate-status {
	padding: 10px;
	border-radius: 6px;
	font-size: 14px;
	margin-bottom: 15px;
	display: none;
}

.certificate-status.checking {
	background-color: #fff3cd;
	color: #856404;
	border: 1px solid #ffeaa7;
	display: block;
}

.certificate-status.success {
	background-color: #d4edda;
	color: #155724;
	border: 1px solid #c3e6cb;
	display: block;
}

.certificate-status.error {
	background-color: #f8d7da;
	color: #721c24;
	border: 1px solid #f5c6cb;
	display: block;
}

.error-message {
	color: var(--error-color);
	font-size: 14px;
	margin-bottom: 15px;
	height: 20px;
	text-align: center;
}

.divider {
	margin: 25px 0;
	display: flex;
	align-items: center;
	text-align: center;
	color: var(--subtle-text-color);
	font-size: 12px;
}

.divider::before, .divider::after {
	content: '';
	flex: 1;
	border-bottom: 1px solid var(--border-color);
}

.divider:not(:empty)::before {
	margin-right: .25em;
}

.divider:not(:empty)::after {
	margin-left: .25em;
}

.signup-link {
	margin-top: 20px;
	font-size: 14px;
	color: var(--subtle-text-color);
}

.signup-link a {
	color: var(--primary-color);
	text-decoration: none;
	font-weight: 500;
}

.signup-link a:hover {
	text-decoration: underline;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media ( max-width : 480px) {
	.login-wrapper {
		padding: 30px 20px;
	}
	.tab-button {
		padding: 10px 12px;
		font-size: 13px;
	}
}
</style>
</head>
<body>
	<div class="login-wrapper">
		<div class="logo">
			<h1>eApproveSystem</h1>
			<p>ì „ìê²°ì¬ ì‹œìŠ¤í…œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</p>
		</div>

		<!-- ë¡œê·¸ì¸ ë°©ì‹ ì„ íƒ íƒ­ -->
		<div class="login-tabs">
			<button type="button" class="tab-button active" data-tab="normal">ì¼ë°˜
				ë¡œê·¸ì¸</button>
			<button type="button" class="tab-button" data-tab="certificate">ê³µì¸ì¸ì¦ì„œ</button>
		</div>

		<div class="login-content">
			<!-- ì¼ë°˜ ë¡œê·¸ì¸ í¼ -->
			<form id="normal-login-form" class="login-form normal-login active">
				<div class="input-group">
					<input type="text" id="username" name="username"
						placeholder="ì‚¬ìš©ì ì´ë¦„" required>
				</div>
				<div class="input-group">
					<input type="password" id="password" name="password"
						placeholder="ë¹„ë°€ë²ˆí˜¸" required>
				</div>
				<div class="form-options">
					<label class="remember-me"> <input type="checkbox"
						id="remember-me"> <span>ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</span>
					</label> <a href="#" onclick="showForgotPassword()">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
				</div>
				<div id="normal-error-message" class="error-message"></div>
				<button type="submit" class="submit-btn">ë¡œê·¸ì¸</button>
			</form>

			<!-- ê³µì¸ì¸ì¦ì„œ ë¡œê·¸ì¸ -->
			<div id="certificate-login" class="login-form certificate-login">
				<div class="certificate-info">
					<h3>ì¸ì¦ì„œ íŒŒì¼ ë¡œê·¸ì¸</h3>
					<p>
						ì¸ì¦ì„œ í…ìŠ¤íŠ¸ íŒŒì¼(.txt)ì„ ì„ íƒí•˜ì—¬<br> ì•ˆì „í•˜ê²Œ ë¡œê·¸ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
					</p>
				</div>

				<!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì„ íƒ input -->
				<input type="file" id="certificate-file" accept=".txt"
					style="display: none;">

				<!-- ì„ íƒëœ íŒŒì¼ ì •ë³´ í‘œì‹œ -->
				<div id="selected-file-info" class="selected-file-info"
					style="display: none;">
					<div class="file-icon">ğŸ“„</div>
					<div class="file-details">
						<div class="file-name" id="file-name"></div>
						<div class="file-size" id="file-size"></div>
					</div>
					<button type="button" class="file-remove-btn" id="remove-file-btn">Ã—</button>
				</div>

				<!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (íŒŒì¼ ì„ íƒ í›„ í‘œì‹œ) -->
				<div id="certificate-password-section"
					class="certificate-password-section" style="display: none;">
					<div class="input-group">
						<input type="password" id="certificate-password"
							placeholder="ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
					</div>
				</div>

				<div id="certificate-status" class="certificate-status"></div>
				<div id="certificate-error-message" class="error-message"></div>

				<button type="button" id="certificate-btn" class="certificate-btn">
					ì¸ì¦ì„œ íŒŒì¼ ì„ íƒ</button>

				<!-- ë¡œê·¸ì¸ ë²„íŠ¼ (íŒŒì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í›„ í‘œì‹œ) -->
				<button type="button" id="certificate-login-btn"
					class="certificate-login-btn" style="display: none;">ì¸ì¦ì„œë¡œ
					ë¡œê·¸ì¸</button>

				<div class="divider">ë˜ëŠ”</div>

				<button type="button" class="submit-btn"
					onclick="switchTab('normal')" style="background-color: #6c757d;">
					ì¼ë°˜ ë¡œê·¸ì¸ìœ¼ë¡œ ë³€ê²½</button>
			</div>
		</div>

		<div class="signup-link">
			ê´€ë¦¬ì ê¶Œí•œ ìš”ì²­: (ë‚´ì„ ) 6241 | <a href="#" onclick="showCertificateHelp()">ê³µì¸ì¸ì¦ì„œ
				ë„ì›€ë§</a>
		</div>
	</div>

	<script>
        // ì „ì—­ ë³€ìˆ˜
        let currentTab = 'normal';
        
        // DOM ìš”ì†Œë“¤
        const tabButtons = document.querySelectorAll('.tab-button');
        const loginForms = document.querySelectorAll('.login-form');
        const normalLoginForm = document.getElementById('normal-login-form');
        const certificateLoginDiv = document.getElementById('certificate-login');
        const normalErrorMessage = document.getElementById('normal-error-message');
        const certificateErrorMessage = document.getElementById('certificate-error-message');
        const certificateStatus = document.getElementById('certificate-status');
        const certificateBtn = document.getElementById('certificate-btn');
        const certificateFile = document.getElementById('certificate-file');
        const selectedFileInfo = document.getElementById('selected-file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const removeFileBtn = document.getElementById('remove-file-btn');
        const certificatePasswordSection = document.getElementById('certificate-password-section');
        const certificatePassword = document.getElementById('certificate-password');
        const certificateLoginBtn = document.getElementById('certificate-login-btn');

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tab) {
            currentTab = tab;
            
            // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                }
            });
            
            // ë¡œê·¸ì¸ í¼ í‘œì‹œ/ìˆ¨ê¹€
            loginForms.forEach(form => {
                form.classList.remove('active');
            });
            
            if (tab === 'normal') {
                normalLoginForm.classList.add('active');
                clearMessages();
            } else if (tab === 'certificate') {
                certificateLoginDiv.classList.add('active');
                clearMessages();
                resetCertificateUI();
            }
        }

        // ë©”ì‹œì§€ ì´ˆê¸°í™”
        function clearMessages() {
            normalErrorMessage.textContent = '';
            certificateErrorMessage.textContent = '';
            certificateStatus.className = 'certificate-status';
            certificateStatus.style.display = 'none';
        }

        // ì¸ì¦ì„œ ê´€ë ¨ UI ì´ˆê¸°í™”
        function resetCertificateUI() {
            selectedFileInfo.style.display = 'none';
            certificatePasswordSection.style.display = 'none';
            certificateLoginBtn.style.display = 'none';
            certificateBtn.style.display = 'block';
            certificatePassword.value = '';
            certificateBtn.textContent = 'ê³µì¸ì¸ì¦ì„œ íŒŒì¼ ì„ íƒ';
        }

        // íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                switchTab(button.dataset.tab);
            });
        });

        // ì¼ë°˜ ë¡œê·¸ì¸ í¼ ì²˜ë¦¬
        normalLoginForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;

            const memberDto = {
                username: username,
                password: password,
                rememberMe: rememberMe
            };

            try {
                normalErrorMessage.textContent = '';
                
                const response = await fetch('/member/logincheck', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(memberDto)
                });

                const result = await response.json();

                if (response.ok) {
                    // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ
                    normalErrorMessage.style.color = 'var(--success-color)';
                    normalErrorMessage.textContent = 'ë¡œê·¸ì¸ ì„±ê³µ! í˜ì´ì§€ë¥¼ ì´ë™í•©ë‹ˆë‹¤...';
                    
                    // ì‚¬ìš©ì ì •ë³´ ì €ì¥ (ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€)
                    if (rememberMe) {
                        localStorage.setItem('username', username);
                    } else {
                        sessionStorage.setItem('username', username);
                    }
                    
                    setTimeout(() => {
                        location.href = '/approval';
                    }, 1000);
                } else {
                    normalErrorMessage.style.color = 'var(--error-color)';
                    normalErrorMessage.textContent = result.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                }
            } catch (error) {
                console.error('Login error:', error);
                normalErrorMessage.style.color = 'var(--error-color)';
                normalErrorMessage.textContent = 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            }
        });

        // ê³µì¸ì¸ì¦ì„œ íŒŒì¼ ì„ íƒ ë²„íŠ¼ í´ë¦­
        certificateBtn.addEventListener('click', () => {
            certificateFile.click();
        });

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        certificateFile.addEventListener('change', (event) => {
            const file = event.target.files[0];
            
            if (file) {
                // íŒŒì¼ í™•ì¥ì ê²€ì¦
                const allowedExtensions = ['.txt'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                
                if (!allowedExtensions.includes(fileExtension)) {
                    certificateErrorMessage.textContent = 'í…ìŠ¤íŠ¸ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (.txt íŒŒì¼ë§Œ ì§€ì›)';
                    certificateFile.value = '';
                    return;
                }
                
                // íŒŒì¼ í¬ê¸° ê²€ì¦ (5MB ì œí•œ)
                if (file.size > 5 * 1024 * 1024) {
                    certificateErrorMessage.textContent = 'íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 5MB)';
                    certificateFile.value = '';
                    return;
                }
                
                // íŒŒì¼ ì •ë³´ í‘œì‹œ
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                selectedFileInfo.style.display = 'flex';
                certificatePasswordSection.style.display = 'block';
                certificateBtn.style.display = 'none';
                
                certificateErrorMessage.textContent = '';
                
                // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
                setTimeout(() => {
                    certificatePassword.focus();
                }, 100);
            }
        });

        // íŒŒì¼ ì œê±° ë²„íŠ¼
        removeFileBtn.addEventListener('click', () => {
            certificateFile.value = '';
            resetCertificateUI();
            clearMessages();
        });

        // ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì´ë²¤íŠ¸
        certificatePassword.addEventListener('input', () => {
            if (certificatePassword.value.trim().length > 0 && certificateFile.files[0]) {
                certificateLoginBtn.style.display = 'block';
            } else {
                certificateLoginBtn.style.display = 'none';
            }
        });

        // ì¸ì¦ì„œ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
        certificateLoginBtn.addEventListener('click', async () => {
            const file = certificateFile.files[0];
            const password = certificatePassword.value;
            
            if (!file || !password) {
                certificateErrorMessage.textContent = 'ì¸ì¦ì„œ íŒŒì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            try {
                certificateErrorMessage.textContent = '';
                certificateStatus.className = 'certificate-status checking';
                certificateStatus.textContent = 'ê³µì¸ì¸ì¦ì„œë¥¼ ê²€ì¦í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...';
                certificateLoginBtn.disabled = true;
                certificateLoginBtn.textContent = 'ì¸ì¦ ì¤‘...';

                // íŒŒì¼ì„ FormDataë¡œ ë³€í™˜í•˜ì—¬ ì„œë²„ì— ì „ì†¡
                await authenticateWithCertificate(file, password);

            } catch (error) {
                console.error('Certificate login error:', error);
                showCertificateError(error.message || 'ê³µì¸ì¸ì¦ì„œ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                certificateLoginBtn.disabled = false;
                certificateLoginBtn.innerHTML = 'ì¸ì¦ì„œë¡œ ë¡œê·¸ì¸';
            }
        });

        // ê³µì¸ì¸ì¦ì„œ ì¸ì¦ ì²˜ë¦¬ í•¨ìˆ˜
        async function authenticateWithCertificate(file, password) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = async function(e) {
                    try {
                        const formData = new FormData();
                        formData.append('certificateFile', file);
                        formData.append('password', password);
                        formData.append('timestamp', new Date().getTime());
                        
                        // ì„œë²„ì— ì¸ì¦ì„œ íŒŒì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ ì „ì†¡
                        const response = await fetch('/member/certificateLogin', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (response.ok) {
                            certificateStatus.className = 'certificate-status success';
                            certificateStatus.textContent = 'ì¸ì¦ì„œ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                            
                            // ì‚¬ìš©ì ì •ë³´ ì €ì¥
                            sessionStorage.setItem('username', result.username || 'MASTER');
                            sessionStorage.setItem('loginMethod', 'certificate');
                            
                            setTimeout(() => {
                                location.href = '/approval';
                            }, 1500);
                            
                            resolve(result);
                        } else {
                            throw new Error(result.message || 'ì¸ì¦ì„œ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }

        // ê³µì¸ì¸ì¦ì„œ ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ êµ¬í˜„ ì‹œ ê³µì¸ì¸ì¦ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©)
        async function simulateCertificateLogin() {
            return new Promise((resolve, reject) => {
                // ì‹¤ì œë¡œëŠ” ê³µì¸ì¸ì¦ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ API í˜¸ì¶œ
                setTimeout(async () => {
                    try {
                        // ê³µì¸ì¸ì¦ì„œ ê²€ì¦ ì‹œë®¬ë ˆì´ì…˜
                        const success = Math.random() > 0.3; // 70% ì„±ê³µë¥ 
                        
                        if (success) {
                            certificateStatus.className = 'certificate-status success';
                            certificateStatus.textContent = 'ê³µì¸ì¸ì¦ì„œ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                            
                            // ì„œë²„ì— ê³µì¸ì¸ì¦ì„œ ë¡œê·¸ì¸ ìš”ì²­
                            const response = await fetch('/member/certificateLogin', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    certificateData: 'simulated_certificate_data',
                                    timestamp: new Date().getTime()
                                })
                            });
                            
                            if (response.ok) {
                                const result = await response.json();
                                sessionStorage.setItem('username', result.username || 'MASTER');
                                
                                setTimeout(() => {
                                    location.href = '/approval';
                                }, 1500);
                            } else {
                                throw new Error('ì„œë²„ ì¸ì¦ ì‹¤íŒ¨');
                            }
                            
                            resolve();
                        } else {
                            throw new Error('ê³µì¸ì¸ì¦ì„œ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        reject(error);
                    }
                }, 2000);
            });
        }

        // ê³µì¸ì¸ì¦ì„œ ì—ëŸ¬ í‘œì‹œ
        function showCertificateError(message) {
            certificateStatus.className = 'certificate-status error';
            certificateStatus.textContent = message;
            certificateErrorMessage.textContent = 'ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ì¼ë°˜ ë¡œê·¸ì¸ì„ ì´ìš©í•´ì£¼ì„¸ìš”.';
        }

        // ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
        function showForgotPassword() {
            alert('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ê¸°ëŠ¥ì€ ê´€ë¦¬ì(ë‚´ì„  6241)ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
        }

        // ê³µì¸ì¸ì¦ì„œ ë„ì›€ë§
        function showCertificateHelp() {
            const helpMessage = `
ì¸ì¦ì„œ íŒŒì¼ ë¡œê·¸ì¸ ë„ì›€ë§:

1. ì§€ì› íŒŒì¼ í˜•ì‹: .txt (í…ìŠ¤íŠ¸ íŒŒì¼)
2. ìµœëŒ€ íŒŒì¼ í¬ê¸°: 5MB
3. ìœ íš¨í•œ ì¸ì¦ì„œ ë‚´ìš©:
   - MASTER_CERTIFICATE_2024 (ë¹„ë°€ë²ˆí˜¸: master123)
   - ADMIN_ACCESS_TOKEN_2024 (ë¹„ë°€ë²ˆí˜¸: admin456)
   - SECURE_LOGIN_KEY_2024 (ë¹„ë°€ë²ˆí˜¸: secure789)
   - EAPPROVE_MASTER_KEY (ë¹„ë°€ë²ˆí˜¸: eapprove2024)

ë¬¸ì œê°€ ì§€ì†ë˜ë©´ IT ì§€ì›íŒ€(ë‚´ì„  6241)ì— ë¬¸ì˜í•˜ì„¸ìš”.

ì§€ì› ë¸Œë¼ìš°ì €: Chrome, Firefox, Safari, Edge
            `;
            alert(helpMessage);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì‚¬ìš©ìëª… ë³µì›
        window.addEventListener('load', () => {
            const savedUsername = localStorage.getItem('username') || sessionStorage.getItem('username');
            if (savedUsername) {
                document.getElementById('username').value = savedUsername;
                document.getElementById('remember-me').checked = !!localStorage.getItem('username');
            }
        });

    </script>
</body>
</html>